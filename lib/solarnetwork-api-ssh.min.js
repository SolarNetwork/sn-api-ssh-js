!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("solarnetwork-api-core")):"function"==typeof define&&define.amd?define(["exports","solarnetwork-api-core"],e):e(t.sn=t.sn||{},t.sn)}(this,function(t,e){"use strict";var n=function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")},r=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=function t(e,n,r){null===e&&(e=Function.prototype);var s=Object.getOwnPropertyDescriptor(e,n);if(void 0===s){var o=Object.getPrototypeOf(e);return null===o?void 0:t(o,n,r)}if("value"in s)return s.value;var i=s.get;if(void 0!==i)return i.call(r)},o=function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)},i=function(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e},u=function t(e,n,r,s){var o=Object.getOwnPropertyDescriptor(e,n);if(void 0===o){var i=Object.getPrototypeOf(e);null!==i&&t(i,n,r,s)}else if("value"in o&&o.writable)o.value=r;else{var u=o.set;void 0!==u&&u.call(s,r)}return r},h=function(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)},a=function(){function t(e,r){n(this,t),this.command=e,this.data=r,this.constructor===t&&Object.freeze(this)}return r(t,[{key:"toJsonEncoding",value:function(){var t={};this.command&&(t.cmd=this.command);var e=this.data;if(e&&e.toJsonEncoding){var n=e.toJsonEncoding();t.data=JSON.parse(n)}else e&&(t.data=e);return JSON.stringify(t)}}],[{key:"fromJsonEncoding",value:function(e,n){var r=void 0,s=void 0;if(e){var o=JSON.parse(e);r=o.cmd,(s=o.data)&&n&&(s=n(JSON.stringify(s)))}return new t(r,s)}}]),t}(),l=function(){function t(r,s,o,i,u,h){n(this,t),this.cols=r||80,this.lines=s||24,this.width=o||640,this.height=i||480,this.type=u||"xterm",this.environment=h instanceof Map?h:e.objectToStringMap(h)}return r(t,[{key:"toJsonEncoding",value:function(){var t={};return this.type&&(t.term=this.type),this.cols&&(t.cols=this.cols),this.lines&&(t.lines=this.lines),this.width&&(t.width=this.width),this.height&&(t.height=this.height),this.environment instanceof Map&&this.environment.size>0&&(t.environment=e.stringMapToObject(this.environment)),JSON.stringify(t)}}],[{key:"fromJsonEncoding",value:function(n){var r=new t;if(n){var s=JSON.parse(n);s.term&&(r.type=s.term),s.cols&&(r.cols=s.cols),s.lines&&(r.lines=s.lines),s.width&&(r.width=s.width),s.height&&(r.height=s.height),s.environment&&(r.environment=e.objectToStringMap(s.environment))}return r}}]),t}(),c="attach-ssh",d=function(t){function e(t,r,s,o,u){n(this,e);var h={};if(h.authorization=t,h["authorization-date"]=r instanceof Date?r.getTime():r,h.username=s,h.password=o,u instanceof l){var a=JSON.parse(u.toJsonEncoding()),d=!0,p=!1,f=void 0;try{for(var v,S=Object.keys(a)[Symbol.iterator]();!(d=(v=S.next()).done);d=!0){var y=v.value;void 0===h[y]&&(h[y]=a[y])}}catch(t){p=!0,f=t}finally{try{!d&&S.return&&S.return()}finally{if(p)throw f}}}return i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,c,h))}return o(e,a),e}(),p=function(t){function e(t,r){n(this,e);var s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this,t,r));return s.constructor===e&&Object.freeze(s),s}return o(e,t),r(e,null,[{key:"enumValues",value:function(){return f}}]),e}(e.ComparableEnum),f=Object.freeze([new p("AUTHENTICATION_FAILURE",4e3)]),v=p.enumsValue(f),S=function(){function t(e,r,s,o,i,u,h,a){n(this,t),this.created=e,this.sessionId=r,this.nodeId=s,this.sshHost=o,this.sshPort=i,this.reverseSshPort=u,this.startInstructionId=h,this.stopInstructionId=a,this.constructor===t&&Object.freeze(this)}return r(t,[{key:"toJsonEncoding",value:function(){var t={};return this.sessionId&&(t.sessionId=this.sessionId),this.created&&(t.created=this.created.getTime()),this.nodeId&&(t.nodeId=this.nodeId),this.sshHost&&(t.host=this.sshHost),this.sshPort&&(t.port=this.sshPort),this.reverseSshPort&&(t.reversePort=this.reverseSshPort),this.startInstructionId&&(t.startInstructionId=this.startInstructionId),this.stopInstructionId&&(t.stopInstructionId=this.stopInstructionId),JSON.stringify(t)}}],[{key:"fromJsonEncoding",value:function(e){var n=[];if(e){var r="string"==typeof e?JSON.parse(e):e;r.created?n.push(new Date(r.created)):n.push(new Date),n.push(r.sessionId||""),n.push(r.nodeId||null),n.push(r.host||""),n.push(r.port||null),n.push(r.reversePort||null),n.push(r.startInstructionId),n.push(r.stopInstructionId)}return new(Function.prototype.bind.apply(t,[null].concat(n)))}}]),t}(),y=function(t){function e(){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(e.NodeInstructionUrlHelperMixin(e.NodeMetadataUrlHelperMixin(e.UserUrlHelperMixin(e.NodeUrlHelperMixin(e.UrlHelper))))),m=function(t){return function(a){function l(){for(var t,r=arguments.length,s=Array(r),o=0;o<r;o++)s[o]=arguments[o];n(this,l);var u=s&&s[0]?s[0]instanceof e.Environment?s[0]:new e.Environment(s[0]):new e.Environment({tls:!0,host:"ssh.solarnetwork.net",port:8443,solarSshPath:""});s||(s=[]),s[0]=u;var a=i(this,(t=l.__proto__||Object.getPrototypeOf(l)).call.apply(t,[this].concat(h(s))));return a._instructionUrlHelper=new y,a._instructionAuthBuilder=new e.AuthorizationV2Builder(null,a._instructionUrlHelper),a}return o(l,t),r(l,[{key:"baseUrl",value:function(){var t=this.env("solarSshPath")||"";return this.hostUrl()+t+"/api/v1"}},{key:"terminalWebSocketUrl",value:function(t){var e=this.env("solarSshPath")||"",n=t||this.sshSessionId;return this.hostWebSocketUrl()+e+"/ssh?sessionId="+encodeURIComponent(n)}},{key:"httpProxyUrl",value:function(t){var e=this.env("solarSshPath")||"",n=t||this.sshSessionId;return this.hostUrl()+e+"/nodeproxy/"+encodeURIComponent(n)+"/"}},{key:"createSshSessionUrl",value:function(t){var e=t||this.nodeId;return this.baseUrl()+"/ssh/session/new?nodeId="+e}},{key:"createSshSessionAuthBuilder",value:function(t){return this._instructionAuthBuilder.reset().snDate(!0).method("GET").url(this._instructionUrlHelper.viewPendingInstructionsUrl(t))}},{key:"startSshSessionUrl",value:function(t){var e=t||this.sshSessionId;return this.baseUrl()+"/ssh/session/"+encodeURIComponent(e)+"/start"}},{key:"startSshSessionAuthBuilder",value:function(t,e){var n=t||this.sshSession||{};return this._instructionAuthBuilder.reset().snDate(!0).method("POST").contentType("application/x-www-form-urlencoded").url(this._instructionUrlHelper.queueInstructionUrl("StartRemoteSsh",[{name:"host",value:n.sshHost},{name:"user",value:n.sessionId},{name:"port",value:n.sshPort},{name:"rport",value:n.reverseSshPort}],e))}},{key:"stopSshSessionUrl",value:function(t){var e=t||this.sshSessionId;return this.baseUrl()+"/ssh/session/"+encodeURIComponent(e)+"/stop"}},{key:"stopSshSessionAuthBuilder",value:function(t,e){var n=t||this.sshSession||{},r=e||this.nodeId;return this._instructionAuthBuilder.reset().snDate(!0).method("POST").contentType("application/x-www-form-urlencoded").url(this._instructionUrlHelper.queueInstructionUrl("StopRemoteSsh",[{name:"host",value:n.sshHost},{name:"user",value:n.sessionId},{name:"port",value:n.sshPort},{name:"rport",value:n.reverseSshPort}],r))}},{key:"viewStartRemoteSshInstructionUrl",value:function(t){var e=this.sshSession||{},n=t||e.startInstructionId;return this._instructionUrlHelper.viewInstructionUrl(n)}},{key:"viewStartRemoteSshInstructionAuthBuilder",value:function(t){return this._instructionAuthBuilder.reset().snDate(!0).url(this.viewStartRemoteSshInstructionUrl(t))}},{key:"viewStopRemoteSshInstructionUrl",value:function(t){var e=this.sshSession||{},n=t||e.stopInstructionId;return this._instructionUrlHelper.viewInstructionUrl(n)}},{key:"viewStopRemoteSshInstructionAuthBuilder",value:function(t){return this._instructionAuthBuilder.reset().snDate(!0).url(this.viewStopRemoteSshInstructionUrl(t))}},{key:"connectTerminalWebSocketAuthBuilder",value:function(t){var e=t||this.nodeId;return this._instructionAuthBuilder.reset().snDate(!0).method("GET").url(this._instructionUrlHelper.viewNodeMetadataUrl(e))}},{key:"sshSession",get:function(){return this.parameter("sshSession")},set:function(t){this.parameter("sshSession",t)}},{key:"nodeId",set:function(t){u(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"nodeId",t,this),this._instructionUrlHelper.nodeId=t},get:function(){return s(l.prototype.__proto__||Object.getPrototypeOf(l.prototype),"nodeId",this)}},{key:"nodeUrlHelperEnvironment",get:function(){return this._instructionUrlHelper.environment},set:function(t){this._instructionUrlHelper.environment=t,this._instructionAuthBuilder.environment=t}},{key:"nodeInstructionAuthBuilder",get:function(){return this._instructionAuthBuilder}},{key:"sshSessionId",get:function(){var t=this.sshSession;return t?t.sessionId:void 0}}]),l}()},I=function(t){function e(){return n(this,e),i(this,(e.__proto__||Object.getPrototypeOf(e)).apply(this,arguments))}return o(e,t),e}(m(e.NodeUrlHelperMixin(e.UrlHelper)));t.AttachSshCommand=d,t.SshCloseCodes=v,t.SshCloseCode=p,t.SshCommand=a,t.SshSession=S,t.SshTerminalSettings=l,t.SshUrlHelperMixin=m,t.SolarSshDefaultPath="",t.SolarSshPathKey="solarSshPath",t.SolarSshApiPathV1="/api/v1",t.SolarSshTerminalWebSocketPath="/ssh",t.SolarSshTerminalWebSocketSubProtocol="solarssh",t.StartRemoteSshInstructionName="StartRemoteSsh",t.StopRemoteSshInstructionName="StopRemoteSsh",t.SshSessionKey="sshSession",t.SshUrlHelper=I,Object.defineProperty(t,"__esModule",{value:!0})});